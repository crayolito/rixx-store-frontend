<div class="contenedor-pagina">
  <section class="carrusel-admin-seccion carrusel-admin-tarjeta">
    <div class="carrusel-admin-cabecera-principal">
      <h2 class="carrusel-admin-titulo">Carrusel</h2>
      <div class="carrusel-admin-botones-cabecera">
        <button type="button" class="boton-secundario" (click)="volver()">Volver</button>
        <button type="button" class="boton-primario" (click)="guardarConfiguracion()">Guardar cambios</button>
      </div>
    </div>
    @if (mensajeGuardado()) {
    <div class="carrusel-admin-mensaje-contenedor" [class.carrusel-admin-mensaje-contenedor--error]="mensajeGuardado() !== 'Configuración guardada correctamente.'">
      <span class="carrusel-admin-mensaje">{{ mensajeGuardado() }}</span>
    </div>
    }

    <p class="carrusel-admin-ayuda">
      Mínimo {{ minSlides }}, máximo {{ maxSlides }} slides. Cada slide tiene imagen móvil e imagen desktop.
      Puedes elegir que al hacer clic vaya a un producto o a una categoría.
    </p>

    @for (slide of slides(); track slide.id; let i = $index) {
    <div class="carrusel-admin-slide-item">
      <div class="carrusel-admin-slide-cabecera">
        <span class="carrusel-admin-slide-numero">Slide {{ i + 1 }}</span>
        @if (puedeQuitarSlide()) {
        <button type="button" class="boton-secundario carrusel-admin-boton-quitar"
          (click)="quitarSlide(i)">Quitar</button>
        }
      </div>

      <div class="carrusel-admin-imagenes-fila">
        <div class="formulario-imagenes carrusel-admin-campo-imagen">
          <label class="global-formulario-campo__etiqueta">Imagen móvil</label>
          <div class="formulario-imagenes__contenedor-imagenes">
            <label [for]="'input-movil-' + slide.id"
              class="global-formulario-imagenes__contenedor global-formulario-imagenes__contenedor--clickeable">
              @if (slide.imagenMovil) {
              <img [src]="slide.imagenMovil" alt="Móvil" class="global-formulario-imagenes__preview">
              } @else {
              <img src="/iconos/ico-imagen.svg" alt="Icono imagen" class="icono-boton icono-color-secundario">
              <span class="global-formulario-imagenes__etiqueta1">Haz clic para subir imagen móvil</span>
              <span class="global-formulario-imagenes__etiqueta2">PNG, JPG, GIF hasta 10MB</span>
              }
            </label>
            <input type="file" [id]="'input-movil-' + slide.id" accept="image/*"
              (change)="actualizarImagenMovil(i, $event)" style="display: none;">
          </div>
        </div>
        <div class="formulario-imagenes carrusel-admin-campo-imagen">
          <label class="global-formulario-campo__etiqueta">Imagen desktop</label>
          <div class="formulario-imagenes__contenedor-imagenes">
            <label [for]="'input-desktop-' + slide.id"
              class="global-formulario-imagenes__contenedor global-formulario-imagenes__contenedor--clickeable">
              @if (slide.imagenDesktop) {
              <img [src]="slide.imagenDesktop" alt="Desktop" class="global-formulario-imagenes__preview">
              } @else {
              <img src="/iconos/ico-imagen.svg" alt="Icono imagen" class="icono-boton icono-color-secundario">
              <span class="global-formulario-imagenes__etiqueta1">Haz clic para subir imagen desktop</span>
              <span class="global-formulario-imagenes__etiqueta2">PNG, JPG, GIF hasta 10MB</span>
              }
            </label>
            <input type="file" [id]="'input-desktop-' + slide.id" accept="image/*"
              (change)="actualizarImagenDesktop(i, $event)" style="display: none;">
          </div>
        </div>
      </div>

      <div class="carrusel-admin-destino-seccion">
        <label class="global-formulario-campo__etiqueta carrusel-admin-etiqueta-destino">Al hacer clic</label>
        <div class="carrusel-admin-opciones-destino">
          <label class="carrusel-admin-radio-item" [class.carrusel-admin-radio-item--activa]="slide.tipoDestino === 'ninguno'">
            <input type="radio" [name]="'destino-' + slide.id" value="ninguno"
              [checked]="slide.tipoDestino === 'ninguno'"
              (change)="actualizarTipoDestino(i, 'ninguno')">
            <span class="carrusel-admin-radio-texto">Ninguno</span>
          </label>
          <label class="carrusel-admin-radio-item" [class.carrusel-admin-radio-item--activa]="slide.tipoDestino === 'producto'">
            <input type="radio" [name]="'destino-' + slide.id" value="producto"
              [checked]="slide.tipoDestino === 'producto'"
              (change)="actualizarTipoDestino(i, 'producto')">
            <span class="carrusel-admin-radio-texto">Ir a producto</span>
          </label>
          <label class="carrusel-admin-radio-item" [class.carrusel-admin-radio-item--activa]="slide.tipoDestino === 'categoria'">
            <input type="radio" [name]="'destino-' + slide.id" value="categoria"
              [checked]="slide.tipoDestino === 'categoria'"
              (change)="actualizarTipoDestino(i, 'categoria')">
            <span class="carrusel-admin-radio-texto">Ir a categoría</span>
          </label>
        </div>
      </div>

      @if (slide.tipoDestino === 'producto') {
      <div class="carrusel-admin-destino-block">
        @if (slide.destinoHandle) {
        <p class="carrusel-admin-seleccionado">Seleccionado: {{ nombreProductoPorHandle(slide.destinoHandle) }}</p>
        }
        <div class="carrusel-admin-buscador-contenedor">
          <img src="/iconos/ico-busqueda.svg" alt="" class="carrusel-admin-buscador-icono">
          <input type="text" class="global-formulario-campo__input carrusel-admin-buscador-input"
            placeholder="Buscar producto..." [value]="busquedaProducto()[i]"
            (input)="setBusquedaProducto(i, $any($event.target).value)">
        </div>
        <div class="carrusel-admin-lista-opciones">
          @for (p of productosFiltradosPara(i); track p.id) {
          <button type="button" class="carrusel-admin-opcion"
            [class.carrusel-admin-opcion--activa]="slide.destinoHandle === p.id"
            (click)="asignarDestinoProducto(i, p)">
            {{ p.nombre }}
          </button>
          }
          @if (productosFiltradosPara(i).length === 0) {
          <span class="carrusel-admin-sin-resultados">Ningún producto coincide.</span>
          }
        </div>
      </div>
      }

      @if (slide.tipoDestino === 'categoria') {
      <div class="carrusel-admin-destino-block">
        @if (slide.destinoHandle) {
        <p class="carrusel-admin-seleccionado">Seleccionado: {{ handleATitulo(slide.destinoHandle) }}</p>
        }
        <div class="carrusel-admin-buscador-contenedor">
          <img src="/iconos/ico-busqueda.svg" alt="" class="carrusel-admin-buscador-icono">
          <input type="text" class="global-formulario-campo__input carrusel-admin-buscador-input"
            placeholder="Buscar categoría..." [value]="busquedaCategoria()[i]"
            (input)="setBusquedaCategoria(i, $any($event.target).value)">
        </div>
        <div class="carrusel-admin-lista-opciones">
          @for (cat of categoriasFiltradasPara(i); track cat.id) {
          <button type="button" class="carrusel-admin-opcion"
            [class.carrusel-admin-opcion--activa]="slide.destinoHandle === cat.handle"
            (click)="asignarDestinoCategoria(i, cat.handle)">
            {{ handleATitulo(cat.handle) }}
          </button>
          }
          @if (categoriasFiltradasPara(i).length === 0) {
          <span class="carrusel-admin-sin-resultados">Ninguna categoría coincide.</span>
          }
        </div>
      </div>
      }
    </div>
    }

    @if (puedeAgregarSlide()) {
    <div class="carrusel-admin-agregar-contenedor">
      <button type="button" class="boton-primario" (click)="agregarSlide()">Agregar slide</button>
    </div>
    }
  </section>
</div>
