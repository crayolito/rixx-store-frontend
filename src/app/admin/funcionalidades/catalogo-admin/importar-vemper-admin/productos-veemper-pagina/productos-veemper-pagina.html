<div class="contenedor-flex">

  <section class="titulo-opciones-contenedor">
    <div class="titulo-contenedor">
      <button type="button" class="boton-volver" (click)="volver()" aria-label="Volver">
        <img src="/iconos/ico-flecha-izquierda-tabla.svg" alt="Volver" class="icono-boton icono-color-base">
      </button>
      <h3>Productos Vemper</h3>
    </div>
    <div class="opciones-contenedor">
      <button class="boton-secundario" (click)="alternarFiltros()" type="button">
        <p>{{ filtrosVisibles() ? 'Ocultar Filtros' : 'Mostrar Filtros' }}</p>
      </button>
    </div>
  </section>

  @if (filtrosVisibles()) {
  <section class="global-filtros">
    <div class="global-filtros__item">
      <p class="global-filtros__titulo">Buscador</p>
      <div class="global-filtros__busqueda">
        <img src="/iconos/ico-busqueda.svg" alt="Icono busqueda" class="icono-boton icono-boton-mediano icono-color-base">
        <input type="text" placeholder="Nombre del producto..." class="global-filtros__input" [value]="textoBusqueda()"
          (input)="actualizarBusqueda($any($event.target).value)">
      </div>
    </div>
    <div class="global-filtros__item">
      <button class="boton-secundario global-filtros__boton-icono" (click)="limpiarFiltros()" type="button"
        aria-label="Limpiar filtros">
        <img src="/iconos/ico-limpiar.svg" alt="Icono limpiar filtros" class="icono-boton icono-boton-mediano icono-color-base">
      </button>
    </div>
  </section>
  }

  <section class="seccion-grid">
    @if (estaCargando()) {
    <app-bloque-estado-tabla estado="cargando" mensajeCarga="Cargando productos..." />
    } @else if (productosPaginados().length === 0) {
    <app-bloque-estado-tabla estado="vacio" tituloVacio="No se encontraron productos"
      textoVacio="No hay productos Vemper en esta categoría o los filtros no coinciden."
      iconoVacio="/iconos/ico-producto.svg" />
    } @else {
    <div class="grid-productos">
      @for (producto of productosPaginados(); track producto.handle) {
      <article class="tarjeta-producto">
        <h4 class="tarjeta-producto__titulo">{{ producto.titulo }}</h4>
        @if (yaImportado(producto.handle)) {
        <span class="tarjeta-producto__importado">Importado</span>
        } @else {
        <button type="button" class="boton-primario tarjeta-producto__boton" (click)="importar(producto)"
          [disabled]="estaImportando(producto.handle)" [attr.aria-label]="'Importar ' + producto.titulo">
          <p>{{ estaImportando(producto.handle) ? 'Importando...' : 'Importar' }}</p>
        </button>
        }
      </article>
      }
    </div>

    @if (totalPaginas() > 0) {
    <div class="global-paginacion">
      <div class="global-paginacion__controles">
        <button class="global-paginacion__boton global-paginacion__boton--anterior" (click)="paginaAnterior()"
          [disabled]="paginaActual() === 1" type="button" aria-label="Página anterior">
          <img src="/iconos/ico-flecha-izquierda-tabla.svg" alt="Icono flecha izquierda"
            class="icono-boton icono-color-base">
        </button>
        <div class="global-paginacion__numeros">
          @for (pagina of paginasAMostrar(); track pagina) {
          @if (pagina === -1) {
          <span class="global-paginacion__separador">...</span>
          } @else {
          <button class="global-paginacion__numero"
            [class.global-paginacion__numero--activa]="pagina === paginaActual()" (click)="irAPagina(pagina)"
            type="button">
            {{ pagina }}
          </button>
          }
          }
        </div>
        <button class="global-paginacion__boton global-paginacion__boton--siguiente" (click)="paginaSiguiente()"
          [disabled]="paginaActual() === totalPaginas()" type="button" aria-label="Página siguiente">
          <img src="/iconos/ico-flecha-derecha-tabla.svg" alt="Icono flecha derecha"
            class="icono-boton icono-color-base">
        </button>
      </div>
      <p class="global-paginacion__info">
        {{ (paginaActual() - 1) * productosPorPagina() + 1 }}-{{ Math.min(paginaActual() * productosPorPagina(),
        totalProductos()) }} de {{ totalProductos() }}
      </p>
    </div>
    }
    }
  </section>
</div>