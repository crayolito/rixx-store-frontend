<div class="contenedor-grid">
  <div class="contenedor-base">
    <!-- Sección: Título y Opciones -->
    <section class="seccion-titulo">
      <div class="titulo-contenedor titulo-contenedor--en-linea">
        <img src="/iconos/ico-producto.svg" alt="Icono productos" class="icono-boton icono-color-base">
        <h3>{{ esEdicion() ? 'Editar Producto' : 'Agregar Producto' }}</h3>
        @if (hayCambiosPendientes()) {
        <span class="panel-titulo-cambios">• Cambios sin guardar</span>
        }
      </div>
      <div class="opciones-contenedor">
        <button type="button" class="boton-secundario" (click)="volver()">
          <p>Volver</p>
        </button>
        @if (hayCambiosPendientes()) {
        <button type="button" class="boton-secundario" (click)="cancelarCambios()" [disabled]="guardando()">
          <p>Cancelar</p>
        </button>
        }
        <button type="button" class="boton-primario" (click)="ejecutarGuardar()"
          [disabled]="guardando() || !puedeGuardar()">
          <p>{{ guardando() ? 'Guardando...' : 'Guardar' }}</p>
        </button>
      </div>
    </section>

    <!-- Sección: Información Básica -->
    <section class="seccion-base">
      <div class="titulo-contenedor">
        <h3>Información Básica</h3>
      </div>
      <div class="global-formulario-campo">
        <label class="global-formulario-campo__etiqueta">Título</label>
        <div class="global-formulario-campo__contenedor">
          <input type="text" class="global-formulario-campo__input" placeholder="Ingrese el título" [value]="titulo()"
            (input)="titulo.set($any($event.target).value)">
        </div>
      </div>
      <div class="formulario-imagenes">
        <label class="global-formulario-campo__etiqueta">Multimedia</label>
        <div class="global-formulario-imagenes__contenedor-imagenes">
          <div class="formulario-imagenes__slot">
            <label [for]="'input-portada'"
              class="global-formulario-imagenes__contenedor global-formulario-imagenes__contenedor--clickeable"
              [class.formulario-imagenes__contenedor--cargando]="subiendoPortada()">
              @if (subiendoPortada()) {
              <div class="formulario-imagenes__cargando">
                <div class="formulario-imagenes__spinner" aria-hidden="true"></div>
                <span>Subiendo...</span>
              </div>
              } @else if (imagenPortada()) {
              <div class="formulario-imagenes__preview-wrap">
                <img [src]="imagenPortada()" alt="Portada" class="global-formulario-imagenes__preview"
                  (error)="$any($event.target).src='/imagenes/imagen-nodisponible.jpg'">
              </div>
              } @else {
              <img src="/iconos/ico-imagen.svg" alt="Icono imagen" class="icono-boton icono-color-secundario">
              <span class="global-formulario-imagenes__etiqueta1">Portada</span>
              <span class="global-formulario-imagenes__etiqueta2">PNG, JPG, GIF hasta 10MB (Cloudinary)</span>
              }
            </label>
            <input type="file" [id]="'input-portada'" accept="image/*" (change)="manejarSubirImagen('portada', $event)"
              [disabled]="subiendoPortada()" class="formulario-imagenes__input-oculto">
          </div>
          <div class="formulario-imagenes__slot">
            <label [for]="'input-banner'"
              class="global-formulario-imagenes__contenedor global-formulario-imagenes__contenedor--clickeable"
              [class.formulario-imagenes__contenedor--cargando]="subiendoBanner()">
              @if (subiendoBanner()) {
              <div class="formulario-imagenes__cargando">
                <div class="formulario-imagenes__spinner" aria-hidden="true"></div>
                <span>Subiendo...</span>
              </div>
              } @else if (imagenBanner()) {
              <div class="formulario-imagenes__preview-wrap">
                <img [src]="imagenBanner()" alt="Banner" class="global-formulario-imagenes__preview"
                  (error)="$any($event.target).src='/imagenes/imagen-nodisponible.jpg'">
              </div>
              } @else {
              <img src="/iconos/ico-imagen.svg" alt="Icono imagen" class="icono-boton icono-color-secundario">
              <span class="global-formulario-imagenes__etiqueta1">Banner (desktop)</span>
              <span class="global-formulario-imagenes__etiqueta2">PNG, JPG, GIF hasta 10MB (Cloudinary)</span>
              }
            </label>
            <input type="file" [id]="'input-banner'" accept="image/*" (change)="manejarSubirImagen('banner', $event)"
              [disabled]="subiendoBanner()" class="formulario-imagenes__input-oculto">
          </div>
        </div>
      </div>
      <div class="formulario-multiple-opcion">
        <div class="formulario-categorias__contenedor">
          <label class="global-formulario-campo__etiqueta">Categorías</label>
          @if (categoriasSeleccionadas().length > 0) {
          <div class="formulario-categorias__seleccionadas">
            @for (categoria of categoriasSeleccionadas(); track categoria.id) {
            <div class="categoria__seleccionada">
              <p>{{ categoria.nombre }}</p>
              <button type="button" class="categoria__boton-eliminar" (click)="eliminarCategoria(categoria)"
                aria-label="Eliminar categoría">
                <img src="/iconos/ico-cerrar.svg" alt="Eliminar" class="icono-boton icono-color-secundario">
              </button>
            </div>
            }
          </div>
          }
          <div class="global-formulario-campo__contenedor global-formulario-campo__contenedor--clickeable"
            (click)="mostrarOpcionesCategorias.set(!mostrarOpcionesCategorias())">
            <p>{{ categoriasSeleccionadas().length }} categoría(s) seleccionada(s)</p>
            <img src="/iconos/ico-expandir-todo.svg" alt="Icono expandir" class="icono-boton icono-color-secundario"
              [class.rotado]="mostrarOpcionesCategorias()">
          </div>
          @if (categoriasSeleccionadas().length === 0) {
          <label class="formulario-etiqueta__anuncio-alerta">Debes seleccionar al menos una categoría</label>
          }
          @if (mostrarOpcionesCategorias()) {
          <div class="formulario-categorias__opciones">
            <div class="formulario-categorias__busqueda">
              <div class="global-formulario-campo__contenedor global-formulario-campo__contenedor--busqueda">
                <img src="/iconos/ico-busqueda.svg" alt="Buscar" class="icono-boton icono-color-secundario">
                <input type="text" class="global-formulario-campo__inputformulario-campo__input--busqueda"
                  placeholder="Buscar categoría..." [value]="buscarCategoria()"
                  (input)="buscarCategoria.set($any($event.target).value)" (click)="$event.stopPropagation()">
              </div>
            </div>
            <div class="formulario-categorias__opciones-lista">
              @if (hayResultadosBusqueda()) {
              @for (categoria of categoriasFiltradas(); track categoria.id) {
              <div class="categoria__opcion" [class.categoria__opcion--seleccionada]="categoria.seleccionada"
                (click)="toggleCategoria(categoria)">
                <p>{{ categoria.nombre }}</p>
                @if (categoria.seleccionada) {
                <img src="/iconos/ico-check.svg" alt="Seleccionada" class="icono-boton icono-color-primario">
                }
              </div>
              }
              } @else {
              <div class="categoria__sin-resultados">
                <p>No se encontraron categorías</p>
              </div>
              }
            </div>
          </div>
          }
        </div>
      </div>
    </section>

    <!-- Sección: Campos Adicionales -->
    <section class="seccion-base seccion-campos-adicionales">
      <div class="titulo-contenedor">
        <h3>Campos Adicionales</h3>
        @if (puedeAgregarCampos()) {
        <div class="opciones-contenedor">
          <button type="button" class="boton-primario" (click)="abrirModalAgregarCampo()">
            <p>Agregar campo</p>
          </button>
        </div>
        }
      </div>
      <p class="seccion-campos-adicionales__descripcion">
        Define los datos que el cliente debe completar al comprar (ej: ID de juego, usuario, servidor). Solo los
        productos sin id Vemper y con «Proceso manual» activado permiten agregar o editar campos adicionales.
      </p>

      @if (!puedeAgregarCampos() && camposAdicionales().length === 0) {
      <div class="campos-adicionales-vacio campos-adicionales-vacio--info">
        <div class="campos-adicionales-vacio__icono">
          <img src="/iconos/ico-informacion.svg" alt="" class="icono-boton-grande icono-color-secundario">
        </div>
        <p class="campos-adicionales-vacio__texto">Este producto no permite agregar campos adicionales.</p>
      </div>
      }

      @if (puedeAgregarCampos() && camposAdicionales().length === 0) {
      <div class="campos-adicionales-vacio">
        <div class="campos-adicionales-vacio__icono">
          <img src="/iconos/ico-imagen.svg" alt="" class="icono-boton-grande icono-color-secundario">
        </div>
        <p class="campos-adicionales-vacio__titulo">Sin campos definidos</p>
        <p class="campos-adicionales-vacio__texto">Haz clic en «Agregar campo» para definir qué información debe
          ingresar el cliente (ej: ID del jugador, zona, correo).</p>
      </div>
      }

      @if (camposAdicionales().length > 0) {
      <div class="formulario-campos-adicionales">
        @for (campo of camposAdicionales(); track campo.id; let i = $index) {
        <div class="campo-adicional-tarjeta" [class.campo-adicional-tarjeta--solo-lectura]="!puedeAgregarCampos()"
          [class.campo-adicional-agregado--arrastrando]="puedeAgregarCampos() && estaArrastrando(campo.id)"
          [class.campo-adicional-agregado--zona-soltar]="puedeAgregarCampos() && tipoArrastrando() === 'campo' && elementoArrastrando() !== campo.id"
          [attr.draggable]="puedeAgregarCampos()"
          (dragstart)="puedeAgregarCampos() && iniciarArrastreCampo($event, campo.id, i)"
          (dragover)="puedeAgregarCampos() && permitirSoltarCampo($event)"
          (drop)="puedeAgregarCampos() && soltarCampo($event, i)" (dragend)="limpiarArrastre()">
          @if (puedeAgregarCampos()) {
          <div class="campo-adicional-tarjeta__arrastrar">
            <img src="/iconos/ico-expandir-todo.svg" alt="Mover" class="icono-boton-mediano icono-color-secundario">
          </div>
          }
          <div class="campo-adicional-tarjeta__contenido">
            <p class="campo-adicional-tarjeta__etiqueta">{{ campo.etiqueta }}</p>
            <div class="campo-adicional-tarjeta__badges">
              <span class="campo-adicional-tarjeta__badge"
                [class.campo-adicional-tarjeta__badge--numero]="campo.tipo === 'numero'">
                {{ campo.tipo === 'numero' ? 'Número' : 'Texto' }}
              </span>
              @if (campo.requerido) {
              <span class="campo-adicional-tarjeta__badge campo-adicional-tarjeta__badge--requerido">Requerido</span>
              }
            </div>
          </div>
          @if (puedeAgregarCampos()) {
          <div class="campo-adicional-tarjeta__acciones">
            <button type="button" class="campo-adicional-agregado__boton" (click)="abrirModalEditarCampo(campo)"
              aria-label="Editar campo">
              <img src="/iconos/ico-editar.svg" alt="Editar" class="icono-boton-mediano icono-color-secundario">
            </button>
            <button type="button" class="campo-adicional-agregado__boton" (click)="eliminarCampoAdicional(campo.id)"
              aria-label="Eliminar campo">
              <img src="/iconos/ico-delete.svg" alt="Eliminar" class="icono-boton-mediano icono-color-secundario">
            </button>
          </div>
          }
        </div>
        }
      </div>
      }
    </section>

    <!-- Sección: Gestión de Precios -->
    <section class="seccion-base">
      <div class="titulo-contenedor">
        <h3>Gestión de Precios</h3>
        @if (!tieneCodigoVemper()) {
        <button type="button" class="boton-primario" (click)="abrirModalAgregarPrecio()">
          <p>Agregar precio</p>
        </button>
        }
      </div>

      @if (precios().length > 0) {
      <div class="formulario-precios">
        @for (precio of precios(); track precio.id; let i = $index) {
        <div class="precio-agregado" [class.precio-agregado--solo-lectura]="tieneCodigoVemper()"
          [class.precio-agregado--arrastrando]="estaArrastrandoPrecio(precio.id)"
          [class.precio-agregado--zona-soltar]="tipoArrastrando() === 'precio' && elementoArrastrando() !== precio.id"
          [attr.draggable]="true" (dragstart)="iniciarArrastrePrecio($event, precio.id, i)"
          (dragover)="permitirSoltarPrecio($event)" (drop)="soltarPrecio($event, i)" (dragend)="limpiarArrastre()">
          <div class="precio-agregado__info">
            <div class="precio-agregado__cabecera">
              <div class="precio-agregado__cabecera-principal">
                <img src="/iconos/icon-opciones.svg" alt="Icono precio"
                  class="icono-boton-mediano icono-color-secundario">
                <p class="precio-agregado__nombre">{{ precio.nombre }}</p>
                <div class="precio-agregado__estados">
                  <span class="precio-agregado__badge" [class.precio-agregado__badge--activo]="precio.precioActivo"
                    [class.precio-agregado__badge--inactivo]="!precio.precioActivo">
                    {{ precio.precioActivo ? 'Activo' : 'Inactivo' }}
                  </span>
                </div>
              </div>
            </div>
            <div class="precio-agregado__detalles">
              <div class="precio-agregado__detalle-item">
                <span class="precio-agregado__detalle-etiqueta">Precio base</span>
                <span class="precio-agregado__detalle-valor">${{ precio.precioBase | number:'1.2-2' }}</span>
              </div>
              <div class="precio-agregado__detalle-item">
                <span class="precio-agregado__detalle-etiqueta">Margen Cliente</span>
                <span class="precio-agregado__detalle-valor">{{ precio.margenClienteFinal }}% → ${{ (precio.precioBase * precio.margenClienteFinal/100) | number:'1.2-2' }}</span>
              </div>
              <div class="precio-agregado__detalle-item">
                <span class="precio-agregado__detalle-etiqueta">Margen Revendedor</span>
                <span class="precio-agregado__detalle-valor">{{ precio.margenRevendedor }}% → ${{ (precio.precioBase * precio.margenRevendedor/100) | number:'1.2-2' }}</span>
              </div>
            </div>

          </div>
          <div class="precio-agregado__acciones">
            <button type="button" class="precio-agregado__boton" (click)="abrirModalEditarPrecio(precio)"
              aria-label="Editar precio">
              <img src="/iconos/ico-editar.svg" alt="Editar" class="icono-boton-mediano icono-color-secundario">
            </button>
            <button type="button" class="precio-agregado__boton" [disabled]="tieneCodigoVemper()"
              (click)="!tieneCodigoVemper() && eliminarPrecio(precio.id)" aria-label="Eliminar precio">
              <img src="/iconos/ico-delete.svg" alt="Eliminar" class="icono-boton-mediano icono-color-secundario">
            </button>
          </div>
        </div>
        }
      </div>
      } @else {
      @if (tieneCodigoVemper()) {
      <div class="global-mensaje-vacio">
        <p class="global-mensaje-vacio__texto">Este producto no permite agregar precios.</p>
      </div>
      } @else {
      <div class="global-mensaje-vacio">
        <div class="global-mensaje-vacio__icono">
          <img src="/iconos/ico-informacion.svg" alt="Icono información"
            class="icono-boton-grande icono-color-secundario">
        </div>
        <div class="global-mensaje-vacio__contenido">
          <h4 class="global-mensaje-vacio__titulo">Nota importante</h4>
          <p class="global-mensaje-vacio__texto">
            Si el producto fue importado de otro sistema, ten en cuenta las siguientes consideraciones:
          </p>
          <ul class="global-mensaje-vacio__lista">
            <li class="global-mensaje-vacio__item">
              <span class="global-mensaje-vacio__item-bullet"></span>
              <p class="global-mensaje-vacio__item-texto">Los productos pueden tener múltiples precios (regular,
                promocional, etc.)</p>
            </li>
            <li class="global-mensaje-vacio__item">
              <span class="global-mensaje-vacio__item-bullet"></span>
              <p class="global-mensaje-vacio__item-texto">Cualquier precio con descuento será considerado
                automáticamente
                como oferta</p>
            </li>
            <li class="global-mensaje-vacio__item">
              <span class="global-mensaje-vacio__item-bullet"></span>
              <p class="global-mensaje-vacio__item-texto">Los precios con descuento aparecerán en la sección de ofertas
                de
                la tienda</p>
            </li>
            <li class="global-mensaje-vacio__item">
              <span class="global-mensaje-vacio__item-bullet"></span>
              <p class="global-mensaje-vacio__item-texto">Un producto puede tener varias ofertas activas al mismo
                tiempo</p>
            </li>
            <li class="global-mensaje-vacio__item">
              <span class="global-mensaje-vacio__item-bullet"></span>
              <p class="global-mensaje-vacio__item-texto">Los precios inactivos no serán visibles para los clientes en
                la
                tienda</p>
            </li>
            <li class="global-mensaje-vacio__item">
              <span class="global-mensaje-vacio__item-bullet"></span>
              <p class="global-mensaje-vacio__item-texto">Puedes reorganizar el orden de los precios arrastrándolos y
                soltándolos</p>
            </li>
          </ul>
        </div>
      </div>
      }
      }
    </section>
  </div>

  <div class="contenedor-base">
    <!-- Sección: Estado -->
    <section class="seccion-base">
      <div class="titulo-contenedor">
        <h3>Estado</h3>
      </div>
      <div class="global-formulario-campo">
        <div class="formulario-estado">
          <label class="formulario-estado__opcion">
            <input type="radio" class="global-radio__input" name="estado-producto" value="activo"
              [checked]="estadoProducto() === 'activo'" (change)="estadoProducto.set('activo')">
            <div class="formulario-estado__contenido">
              <p class="formulario-estado__titulo">Activo</p>
            </div>
          </label>
          <label class="formulario-estado__opcion">
            <input type="radio" class="global-radio__input" name="estado-producto" value="inactivo"
              [checked]="estadoProducto() === 'inactivo'" (change)="estadoProducto.set('inactivo')">
            <div class="formulario-estado__contenido">
              <p class="formulario-estado__titulo">Inactivo</p>
            </div>
          </label>
        </div>
      </div>
    </section>

    <!-- Sección: Sincronización automática -->
    @if (tieneCodigoVemper()) {
    <section class="seccion-base">
      <div class="titulo-contenedor">
        <h3>Sincronización automática</h3>
      </div>
      <div class="global-checkbox seccion-disponibilidad__sincronizacion">
        <input type="checkbox" id="sincronizacion-automatica" name="sincronizacion-automatica"
          class="global-checkbox__input" [checked]="sincronizacionAutomatica()"
          (change)="sincronizacionAutomatica.set($any($event.target).checked)" />
        <label for="sincronizacion-automatica" class="global-checkbox__contenido">
          <p class="global-checkbox__descripcion">Los cambios manuales pueden ser
            sobrescritos por la sincronización automática. Desactívala si deseas mantener los cambios manuales.</p>
        </label>
      </div>
    </section>
    }

    <!-- Sección: Proceso manual (solo productos sin id Vemper) -->
    @if (!tieneCodigoVemper()) {
    <section class="seccion-base">
      <div class="titulo-contenedor">
        <h3>Proceso manual</h3>
      </div>
      <div class="global-checkbox seccion-disponibilidad__sincronizacion">
        <input type="checkbox" id="proceso-manual" name="proceso-manual" class="global-checkbox__input"
          [checked]="procesoManual()" (change)="alCambiarProcesoManual($any($event.target).checked)" />
        <label for="proceso-manual" class="global-checkbox__contenido">
          <p class="global-checkbox__descripcion">
            Al activar esta opción, podrás agregar campos personalizados (como
            nickname, ID de servidor, etc.) que el cliente deberá completar al comprar. Tú procesarás las recargas
            manualmente.
            <br>
            <strong>Nota importante:</strong> Los productos con proceso manual NO permiten la generación de códigos
            automáticos.
          </p>
        </label>
      </div>
    </section>
    }

    <!-- Sección: Contenido -->
    <section class="seccion-base">
      <div class="titulo-contenedor">
        <h3>Contenido</h3>
      </div>
      <div class="global-formulario-campo">
        <label class="global-formulario-campo__etiqueta">Descripción</label>
        <div class="global-formulario-campo__contenedor global-formulario-campo__contenedor--textarea">
          <textarea class="global-formulario-campo__textarea"
            placeholder="Ingrese la descripción del producto. Puedes agregar enlaces usando formato: [texto](url)"
            [value]="descripcion()" (input)="descripcion.set($any($event.target).value)" rows="4"></textarea>
        </div>
        <label class="global-formulario-campo__ayuda">Puedes agregar enlaces usando el formato: [texto del
          enlace](https://ejemplo.com)</label>
      </div>
      <div class="global-formulario-campo">
        <label class="global-formulario-campo__etiqueta">Instrucciones</label>
        <div class="global-formulario-campo__contenedor global-formulario-campo__contenedor--textarea">
          <textarea class="global-formulario-campo__textarea"
            placeholder="Ingrese las instrucciones de uso. Puedes agregar enlaces usando formato: [texto](url)"
            [value]="instrucciones()" (input)="instrucciones.set($any($event.target).value)" rows="4"></textarea>
        </div>
        <label class="global-formulario-campo__ayuda">Puedes agregar enlaces usando el formato: [texto del
          enlace](https://ejemplo.com)</label>
      </div>
      <div class="global-formulario-campo">
        <label class="global-formulario-campo__etiqueta">Términos y Condiciones</label>
        <div class="global-formulario-campo__contenedor global-formulario-campo__contenedor--textarea">
          <textarea class="global-formulario-campo__textarea"
            placeholder="Ingrese los términos y condiciones. Puedes agregar enlaces usando formato: [texto](url)"
            [value]="terminos()" (input)="terminos.set($any($event.target).value)" rows="4"></textarea>
        </div>
        <label class="global-formulario-campo__ayuda">Puedes agregar enlaces usando el formato: [texto del
          enlace](https://ejemplo.com)</label>
      </div>
    </section>
  </div>
</div>


<!-- Modal: Tipo de Campo -->
<app-modal [estaAbierto]="modalTipoCampoAbierto()" (cerrar)="cerrarModalTipoCampo()">
  <div class="global-modal">
    <div class="global-modal__cabecera">
      <h3 class="global-modal__titulo">{{ campoAdicionalEditando() ? 'Editar Campo' : 'Agregar Campo' }}</h3>
      <button type="button" class="global-modal__boton-cerrar" (click)="cerrarModalTipoCampo()"
        aria-label="Cerrar modal">
        <img src="/iconos/ico-cerrar.svg" alt="Cerrar" class="icono-boton icono-color-secundario">
      </button>
    </div>
    <div class="global-modal__contenido">
      <div class="global-formulario-campo">
        <label class="global-formulario-campo__etiqueta">Etiqueta del Campo</label>
        <div class="global-formulario-campo__contenedor">
          <input type="text" class="global-formulario-campo__input" placeholder="Ej: ID del jugador"
            [value]="etiquetaCampo()" (input)="etiquetaCampo.set($any($event.target).value)">
        </div>
        <label class="global-formulario-campo__ayuda">
          Se generará automáticamente el identificador. Ej: id_del_jugador
        </label>
      </div>

      <div class="global-formulario-campo">
        <label class="global-formulario-campo__etiqueta">Tipo de Campo</label>
        <div class="global-formulario-opciones-radio">
          <label class="global-formulario-opciones-radio__opcion">
            <input type="radio" name="tipo-campo" value="texto" [checked]="tipoCampoSeleccionado() === 'texto'"
              (change)="tipoCampoSeleccionado.set('texto')" class="global-radio__input">
            <span class="global-formulario-opciones-radio__label">Texto</span>
          </label>
          <label class="global-formulario-opciones-radio__opcion">
            <input type="radio" name="tipo-campo" value="numero" [checked]="tipoCampoSeleccionado() === 'numero'"
              (change)="tipoCampoSeleccionado.set('numero')" class="global-radio__input">
            <span class="global-formulario-opciones-radio__label">Número</span>
          </label>
        </div>
      </div>

      <div class="global-checkbox">
        <input type="checkbox" id="campo-requerido-modal" name="campo-requerido-modal" [checked]="campoRequerido()"
          (change)="campoRequerido.set($any($event.target).checked)" class="global-checkbox__input" />
        <label for="campo-requerido-modal" class="global-checkbox__contenido">
          <p class="global-checkbox__titulo">Campo requerido</p>
        </label>
      </div>
    </div>
    <div class="global-modal__acciones">
      <button type="button" class="boton-secundario" (click)="cerrarModalTipoCampo()">
        <p>Cancelar</p>
      </button>
      <button type="button" class="boton-primario" (click)="guardarCampoAdicional()">
        <p>{{ campoAdicionalEditando() ? 'Guardar Cambios' : 'Agregar' }}</p>
      </button>
    </div>
  </div>
</app-modal>

<!-- Modal: Precio -->
<app-modal [estaAbierto]="modalPrecioAbierto()" (cerrar)="cerrarModalPrecio()">
  <div class="global-modal global-modal--ancho modal-precio">
    <div class="global-modal__cabecera">
      <h3 class="global-modal__titulo">{{ precioEditando() ? 'Editar Precio' : 'Agregar Precio' }}</h3>
      <button type="button" class="global-modal__boton-cerrar" (click)="cerrarModalPrecio()" aria-label="Cerrar modal">
        <img src="/iconos/ico-cerrar.svg" alt="Cerrar" class="icono-boton icono-color-secundario">
      </button>
    </div>
    <div class="global-modal__contenido modal-precio__contenido">
      <!-- Fila 1: Solo Nombre de precio -->
      <div class="modal-precio__fila">
        <div class="global-formulario-campo">
          <label class="global-formulario-campo__etiqueta">Nombre de precio</label>
          <div class="global-formulario-campo__contenedor">
            <input type="text" class="global-formulario-campo__input" placeholder="Ej: Precio estándar"
              [value]="nombrePrecio()" (input)="nombrePrecio.set($any($event.target).value)">
          </div>
        </div>
      </div>
      <!-- Fila 2: Precio base -->
      <div class="modal-precio__fila">
        <div class="global-formulario-campo">
          <label class="global-formulario-campo__etiqueta">Precio base</label>
          <div class="global-formulario-campo__contenedor">
            <input type="number" class="global-formulario-campo__input" placeholder="0.00" step="0.01" min="0"
              [value]="precioBase()" (input)="precioBase.set($any($event.target).valueAsNumber || 0)">
          </div>
        </div>
      </div>
      <!-- Fila 3: Margen Cliente y Margen Revendedor -->
      <div class="modal-precio__fila modal-precio__fila--dos">
        <div class="global-formulario-campo">
          <label class="global-formulario-campo__etiqueta">Margen Cliente %</label>
          <div class="global-formulario-campo__contenedor">
            <input type="number" class="global-formulario-campo__input" placeholder="0" step="0.01" min="0"
              [value]="margenClienteFinal()" (input)="margenClienteFinal.set($any($event.target).valueAsNumber || 0)">
          </div>
          @if (precioBase() > 0 && margenClienteFinal() > 0) {
          <span class="global-formulario-campo__ayuda">${{ margenClienteEnDolares() | number:'1.2-2' }} del precio base</span>
          }
        </div>
        <div class="global-formulario-campo">
          <label class="global-formulario-campo__etiqueta">Margen Revendedor %</label>
          <div class="global-formulario-campo__contenedor">
            <input type="number" class="global-formulario-campo__input" placeholder="0" step="0.01" min="0"
              [value]="margenRevendedor()" (input)="margenRevendedor.set($any($event.target).valueAsNumber || 0)">
          </div>
        </div>
      </div>
      <!-- Fila 4: Solo cálculos (precio base × cada porcentaje), sin inputs -->
      <div class="modal-precio__fila modal-precio__fila--dos modal-precio__fila--calculos">
        <div class="modal-precio__calculo">
          <span class="modal-precio__calculo-etiqueta">Precio Cliente Final</span>
          <span class="modal-precio__calculo-valor">{{ precioClienteFinalCalculado() | number:'1.2-2' }}</span>
        </div>
        <div class="modal-precio__calculo">
          <span class="modal-precio__calculo-etiqueta">Precio Revendedor</span>
          <span class="modal-precio__calculo-valor">{{ precioRevendedorCalculado() | number:'1.2-2' }}</span>
        </div>
      </div>
      <!-- Fila 5: Un solo checkbox Precio Activo -->
      <div class="modal-precio__fila">
        <div class="global-formulario-campo global-formulario-campo--checkbox">
          <div class="global-checkbox">
            <input type="checkbox" id="modal-precio-activo" class="global-checkbox__input" [checked]="precioActivo()"
              (change)="precioActivo.set($any($event.target).checked)">
            <label for="modal-precio-activo" class="global-checkbox__contenido">
              <p class="global-checkbox__titulo">Precio Activo</p>
            </label>
          </div>
        </div>
      </div>
    </div>
    <div class="global-modal__acciones">
      <button type="button" class="boton-secundario" (click)="cerrarModalPrecio()">
        <p>Cancelar</p>
      </button>
      <button type="button" class="boton-primario" (click)="guardarPrecio()">
        <p>{{ precioEditando() ? 'Actualizar' : 'Agregar' }}</p>
      </button>
    </div>
  </div>
</app-modal>